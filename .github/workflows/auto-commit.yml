# å·¥ä½œæµçš„åç§°
name: Auto Commit & Keep Green

on:
  # å…è®¸ä½ æ‰‹åŠ¨åœ¨ Actions é¡µé¢ç‚¹å‡»æŒ‰é’®æ¥è§¦å‘è¿™ä¸ªå·¥ä½œæµ
  workflow_dispatch:
  
  # è®¾ç½®å®šæ—¶è§¦å‘å™¨
  schedule:
    # Cron è¡¨è¾¾å¼ï¼Œè¡¨ç¤ºåœ¨æ¯å¤©çš„ UTC æ—¶é—´ 18:00 è¿è¡Œ
    # UTC 18:00 ç›¸å½“äºåŒ—äº¬æ—¶é—´ (UTC+8) çš„å‡Œæ™¨ 2:00
    # ä½ å¯ä»¥æ ¹æ®è‡ªå·±çš„éœ€è¦ä¿®æ”¹æ—¶é—´
    - cron: '0 18 * * *'

# å®šä¹‰ä¸€ä¸ªä»»åŠ¡
jobs:
  auto-commit:
    # æŒ‡å®šä»»åŠ¡è¿è¡Œçš„æœåŠ¡å™¨ç¯å¢ƒ
    runs-on: ubuntu-latest

    # ä¸ºæ­¤ä»»åŠ¡ä¸­çš„æ‰€æœ‰æ­¥éª¤è®¾ç½®æƒé™
    # è¿™æ˜¯å¿…é¡»çš„ï¼Œå› ä¸ºæˆ‘ä»¬éœ€è¦æƒé™æ¥å†™å…¥å’Œæäº¤ä»£ç 
    permissions:
      contents: write

    # å®šä¹‰è¯¥ä»»åŠ¡ä¸‹çš„æ‰€æœ‰æ­¥éª¤
    steps:
      # ç¬¬1æ­¥ï¼šæ£€å‡ºï¼ˆä¸‹è½½ï¼‰ä½ çš„ä»“åº“ä»£ç åˆ°æœåŠ¡å™¨ä¸Š
      # è¿™æ˜¯å¿…é¡»çš„æ­¥éª¤ï¼Œåç»­æ“ä½œéƒ½åŸºäºè¿™ä»½ä»£ç 
      - name: Checkout repository
        uses: actions/checkout@v4

      # ç¬¬2æ­¥ï¼šä¿®æ”¹æ–‡ä»¶å†…å®¹
      # è¿™é‡Œæˆ‘ä»¬ç”¨ Linux çš„ date å‘½ä»¤å°†å½“å‰æ—¶é—´å†™å…¥ update.log æ–‡ä»¶
      - name: Modify file
        run: |
          echo "Last updated: $(date '+%Y-%m-%d %H:%M:%S')" > update.log

      # ç¬¬3æ­¥ï¼šæäº¤æ›´æ”¹
      - name: Commit changes
        run: |
          # è®¾ç½® Git çš„ç”¨æˆ·ä¿¡æ¯ï¼Œè¿™æ ·æäº¤è®°å½•æ‰ä¼šæ˜¾ç¤ºä½ çš„åå­—
          git config --global user.name "${{ github.actor }}"
          git config --global user.email "${{ github.actor }}@users.noreply.github.com"
          
          # å°†ä¿®æ”¹çš„æ–‡ä»¶æ·»åŠ åˆ°æš‚å­˜åŒº
          git add .
          
          # ä½¿ç”¨ git status æ£€æŸ¥æ˜¯å¦æœ‰å˜åŠ¨ï¼Œå¦‚æœæœ‰æ‰è¿›è¡Œæäº¤
          # è¿™å¯ä»¥é˜²æ­¢åœ¨æ²¡æœ‰æ–‡ä»¶å˜åŠ¨æ—¶åˆ›å»ºç©ºçš„æäº¤è€Œå¯¼è‡´å·¥ä½œæµå¤±è´¥
          if ! git diff --staged --quiet; then
            git commit -m "chore: Auto update log file ğŸ¤–"
            git push
          else
            echo "No changes to commit."
          fi